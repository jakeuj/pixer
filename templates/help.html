{% extends "base.html" %}

{% block title %}Help - Pixer Web Interface{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title mb-0">
                    <i class="fas fa-question-circle me-2"></i>Pixer Web Interface Help
                </h4>
            </div>
            <div class="card-body">
                <div class="accordion" id="helpAccordion">
                    <!-- Getting Started -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingGettingStarted">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#collapseGettingStarted">
                                <i class="fas fa-play-circle me-2"></i>Getting Started
                            </button>
                        </h2>
                        <div id="collapseGettingStarted" class="accordion-collapse collapse show" 
                             data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <ol>
                                    <li><strong>Power on your Pixer device</strong> and wait for it to boot up</li>
                                    <li><strong>Connect to the Pixer WiFi network</strong> (usually named "Pixer-XXXX")</li>
                                    <li><strong>Open this web interface</strong> in your browser at <code>http://localhost:8000</code></li>
                                    <li><strong>Check device status</strong> on the home page or device page</li>
                                    <li><strong>Upload images</strong> using the upload page or home page form</li>
                                </ol>
                                
                                <div class="alert alert-info mt-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Important:</strong> You must be connected to the Pixer WiFi network 
                                    for this interface to communicate with the device.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Image Upload -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingImageUpload">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#collapseImageUpload">
                                <i class="fas fa-upload me-2"></i>Image Upload
                            </button>
                        </h2>
                        <div id="collapseImageUpload" class="accordion-collapse collapse" 
                             data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <h6>Supported Image Formats</h6>
                                <div class="row mb-3">
                                    {% for format in supported_formats %}
                                    <div class="col-md-2 col-sm-3 col-4 mb-2">
                                        <span class="badge bg-primary">{{ format.upper() }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <h6>Image Processing</h6>
                                <ul>
                                    <li><strong>Automatic rotation:</strong> Portrait images are rotated to landscape</li>
                                    <li><strong>Automatic resizing:</strong> Images are resized to 1872×1404 pixels</li>
                                    <li><strong>Aspect ratio preservation:</strong> Images are scaled and cropped to fit</li>
                                    <li><strong>Grayscale conversion:</strong> All images are converted to 4-bit grayscale</li>
                                </ul>
                                
                                <h6>Upload Process</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ol class="small">
                                            <li>Image validation</li>
                                            <li>Image processing</li>
                                            <li>Device connection</li>
                                            <li>Data upload</li>
                                            <li>Display update</li>
                                        </ol>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="small">
                                            <strong>Typical upload times:</strong>
                                            <ul class="list-unstyled">
                                                <li>Small (&lt;1MB): 10-30 seconds</li>
                                                <li>Medium (1-5MB): 30-60 seconds</li>
                                                <li>Large (&gt;5MB): 1-3 minutes</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Device Management -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingDeviceManagement">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#collapseDeviceManagement">
                                <i class="fas fa-cog me-2"></i>Device Management
                            </button>
                        </h2>
                        <div id="collapseDeviceManagement" class="accordion-collapse collapse" 
                             data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <h6>Device Status Check</h6>
                                <p>Use the "Check Device Status" button to:</p>
                                <ul>
                                    <li>Verify connection to the device</li>
                                    <li>Get current battery level</li>
                                    <li>Check firmware versions (BLE, MCU, ITE)</li>
                                    <li>Refresh cached device information</li>
                                </ul>
                                
                                <h6>Device Reset</h6>
                                <p>Use the "Reset Device" button when:</p>
                                <ul>
                                    <li>The device becomes unresponsive</li>
                                    <li>Upload operations fail repeatedly</li>
                                    <li>The display shows corrupted content</li>
                                </ul>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Note:</strong> Resetting the device will restart it and may take 
                                    30-60 seconds to become available again.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Troubleshooting -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTroubleshooting">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#collapseTroubleshooting">
                                <i class="fas fa-wrench me-2"></i>Troubleshooting
                            </button>
                        </h2>
                        <div id="collapseTroubleshooting" class="accordion-collapse collapse" 
                             data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <h6>Connection Issues</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Problem</th>
                                                <th>Solution</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Device not found</td>
                                                <td>Check WiFi connection to Pixer network</td>
                                            </tr>
                                            <tr>
                                                <td>Connection timeout</td>
                                                <td>Ensure device is powered on and responsive</td>
                                            </tr>
                                            <tr>
                                                <td>Upload fails</td>
                                                <td>Check battery level, try device reset</td>
                                            </tr>
                                            <tr>
                                                <td>Slow uploads</td>
                                                <td>Use smaller images, check WiFi signal</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <h6>Image Issues</h6>
                                <ul>
                                    <li><strong>File too large:</strong> Maximum file size is 16MB</li>
                                    <li><strong>Unsupported format:</strong> Use JPG, PNG, BMP, TIFF, or WebP</li>
                                    <li><strong>Poor quality:</strong> Use high-resolution source images</li>
                                    <li><strong>Wrong orientation:</strong> Images are auto-rotated to landscape</li>
                                </ul>
                                
                                <h6>Performance Tips</h6>
                                <ul>
                                    <li>Use images close to 1872×1404 resolution for best results</li>
                                    <li>Compress large images before uploading</li>
                                    <li>Ensure good WiFi signal strength</li>
                                    <li>Keep device battery above 20% during uploads</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Technical Details -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTechnical">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#collapseTechnical">
                                <i class="fas fa-microchip me-2"></i>Technical Details
                            </button>
                        </h2>
                        <div id="collapseTechnical" class="accordion-collapse collapse" 
                             data-bs-parent="#helpAccordion">
                            <div class="accordion-body">
                                <h6>Device Specifications</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <td>Display</td>
                                                <td>7.8" E-Ink, 1872×1404 pixels</td>
                                            </tr>
                                            <tr>
                                                <td>Controller</td>
                                                <td>IT8951E</td>
                                            </tr>
                                            <tr>
                                                <td>WiFi MCU</td>
                                                <td>CC3xxx series</td>
                                            </tr>
                                            <tr>
                                                <td>Communication</td>
                                                <td>TCP socket on port 6000</td>
                                            </tr>
                                            <tr>
                                                <td>Image Format</td>
                                                <td>4-bit grayscale, packed format</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <h6>Protocol Commands</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr>
                                                <td><code>#TEST#</code></td>
                                                <td>Test connection (returns "Hello PC!")</td>
                                            </tr>
                                            <tr>
                                                <td><code>batteryLevel</code></td>
                                                <td>Get battery percentage</td>
                                            </tr>
                                            <tr>
                                                <td><code>bleVersion</code></td>
                                                <td>Get Bluetooth firmware version</td>
                                            </tr>
                                            <tr>
                                                <td><code>mcuVersion</code></td>
                                                <td>Get MCU firmware version</td>
                                            </tr>
                                            <tr>
                                                <td><code>iteVersion</code></td>
                                                <td>Get display controller version</td>
                                            </tr>
                                            <tr>
                                                <td><code>reset</code></td>
                                                <td>Reset device</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-body text-center">
                <h6><i class="fas fa-heart text-danger me-2"></i>Need More Help?</h6>
                <p class="text-muted">
                    This web interface is designed to make using your Pixer device easier. 
                    If you encounter issues not covered here, try checking the device connection 
                    and ensuring you're on the correct WiFi network.
                </p>
                <a href="{{ url_for('index') }}" class="btn btn-primary">
                    <i class="fas fa-home me-2"></i>Back to Home
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
